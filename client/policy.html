<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì²­ë…„ ê·€ë† ì§€ì› ì •ì±…</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; position: relative; }
h1 { text-align: center; color: #2d6a4f; }
.category-btn { display: inline-block; margin: 10px; padding: 10px 20px; background: #40916c; color: white; border: none; border-radius: 5px; cursor: pointer; }
.category-btn:hover { background: #2d6a4f; }
.policy-card { border: 1px solid #ccc; border-radius: 5px; padding: 15px; margin: 10px 0; background: white; cursor: pointer; }
.policy-description { font-size: 0.9em; color: #555; }
.policy-source { font-size: 0.8em; color: #888; margin-top: 5px; }
.modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); }
.modal-content { background: white; margin: 10% auto; padding: 20px; width: 80%; border-radius: 5px; position: relative; }
.close { position: absolute; top: 10px; right: 15px; font-size: 1.5em; cursor: pointer; }
.modal a { color: #40916c; }
#region-selection { text-align:center; margin-bottom:15px; }
#selected-region-tag { display:none; margin-left:10px; color:white; background:#2d6a4f; padding:5px 10px; border-radius:15px; }

/* ì¦ê²¨ì°¾ê¸° ë²„íŠ¼ */
#favorite-btn {
  position: fixed;
  top: 20px;
  right: 25px;
  background: #ffd166;
  color: #333;
  border: none;
  padding: 10px 20px;
  border-radius: 25px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
#favorite-btn:hover { background: #fcbf49; }

/* ìµœê·¼ ë³¸ ì •ì±… ë²„íŠ¼ */
#recent-btn {
  position: fixed;
  top: 70px;
  right: 25px;
  background: #b7e4c7;
  color: #333;
  border: none;
  padding: 10px 20px;
  border-radius: 25px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
#recent-btn:hover { background: #95d5b2; }
</style>
</head>
<body>

<h1>ì²­ë…„ ê·€ë† ì§€ì› ì •ì±…</h1>

<button id="favorite-btn" onclick="showFavorites()">â­ ì¦ê²¨ì°¾ê¸°</button>
<button id="recent-btn" onclick="showRecent()">ğŸ“„ ìµœê·¼ ë³¸ ì •ì±…</button>

<div id="region-selection">
  <label for="region-select"><strong>ì§€ì—­ ì„ íƒ:</strong></label>
  <select id="region-select" onchange="selectRegion()">
	  <option value="">ì „ì²´ ì§€ì—­</option>
    <option value="ì„œìš¸íŠ¹ë³„ì‹œ">ì„œìš¸íŠ¹ë³„ì‹œ</option>
		<option value="ì „ë¼ë‚¨ë„">ì „ë¼ë‚¨ë„</option>
		<option value="ì „ë¼ë¶ë„">ì „ë¼ë¶ë„</option>
		<option value="ë¶€ì‚°ê´‘ì—­ì‹œ">ë¶€ì‚°ê´‘ì—­ì‹œ</option>
		<option value="ê´‘ì£¼ê´‘ì—­ì‹œ">ê´‘ì£¼ê´‘ì—­ì‹œ</option>
		<option value="ìš¸ì‚°ê´‘ì—­ì‹œ">ìš¸ì‚°ê´‘ì—­ì‹œ</option>
		<option value="ëŒ€ì „ê´‘ì—­ì‹œ">ëŒ€ì „ê´‘ì—­ì‹œ</option>
    <option value="ëŒ€êµ¬ê´‘ì—­ì‹œ">ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
  </select>
  <span id="selected-region-tag"></span>
</div>

<div id="category-selection" style="display:none;">
  <button class="category-btn" onclick="showCategory('income')">ì†Œë“Â·ì •ì°© ì§€ì›</button>
  <button class="category-btn" onclick="showCategory('education')">êµìœ¡Â·ì»¨ì„¤íŒ… ì§€ì›</button>
  <button class="category-btn" onclick="showCategory('startup')">ê¸°ìˆ /ì°½ì—… ì§€ì›</button>
</div>

<div id="policy-container"></div>
<div id="sub-category-container" style="display:none;"></div>

<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <div id="modal-body"></div>
  </div>
</div>

<script>
// ------------------ ì§€ì—­ ì„ íƒ ------------------
function selectRegion() {
  const regionSelect = document.getElementById('region-select');
  const categorySelection = document.getElementById('category-selection');
  const selectedTag = document.getElementById('selected-region-tag');
  const selectedValue = regionSelect.value;

  if (selectedValue) {
    categorySelection.style.display = 'block';
    selectedTag.style.display = 'inline-block';
    selectedTag.textContent = regionSelect.options[regionSelect.selectedIndex].text;
  } else {
    categorySelection.style.display = 'none';
    selectedTag.style.display = 'none';
    selectedTag.textContent = '';
  }

  document.getElementById('policy-container').innerHTML = '';
  document.getElementById('sub-category-container').style.display = 'none';
}

// ------------------ ì •ì±… ë°ì´í„° ------------------
const policies = {
  income: [
    {
      id: "income",
      title:"ì†Œë“ ì§€ì›ì‚¬ì—…",
      description:"ê·€ë†í•˜ëŠ” ì‚¬ëŒë“¤ì„ ìœ„í•œ ì†Œë“ì§€ì› ì •ì±…",
      source:" ",
      subcategories: [
        {
      
          id: "income1",
          name: "ê·€ë† ë†ì—…ì°½ì—… ë° ì£¼íƒêµ¬ì… ì§€ì›ì‚¬ì—…",
          details: "ì§€ì›ìê²©: ì´ì£¼ê¸°í•œ:ì „ì…ì¼ë¡œë¶€í„° ë§Œ 5ë…„ì´ ê²½ê³¼í•˜ì§€ ì•Šì€ ì„¸ëŒ€ì£¼ë¡œì„œ ë†ì´Œì— ê°€ì¡±ê³¼ í•¨ê»˜ ì‹¤ì œ ê±°ì£¼í•˜ë©´ì„œ ë†ì—… ì¢…ì‚¬í•˜ê³  ìˆëŠ” ì<br>ê±°ì£¼ê¸°ê°„:ë†ì´Œì§€ì—­ ì „ì…ì¼ì„ ê¸°ì¤€ìœ¼ë¡œ ë†ì´Œì§€ì—­ ì´ì£¼ ì§ì „ì— 1ë…„ ì´ìƒ ì§€ì†ì ìœ¼ë¡œ ë†ì´Œ ì™¸ì˜ ì§€ì—­ì—ì„œ ê±°ì£¼í•œ ì<br><br>",
          source: "ì¶œì²˜: ë†ë¦¼ì¶•ì‚°ì‹í’ˆë¶€",
          link: ["https://www.greendaero.go.kr/svc/rfph/cpif/front/home.do"]
        }
      ]
    
    }
  ],
  education: [
        {
          title: "ê·€ë† ì¤€ë¹„ êµìœ¡",
          description: "ë†ì—… ê¸°ìˆ , ì°½ì—… ë“± ê·€ë† ì¤€ë¹„ë¥¼ ìœ„í•œ êµìœ¡ ê³¼ì • ì œê³µ",
          source: "ì¶œì²˜: ì§€ìì²´ ë†ì—…ê¸°ìˆ ì„¼í„°",
          subcategories: [
            {
              name: "ë†ì—…êµìœ¡í¬í„¸",
              details: "ì˜ˆë¹„ë†, ì‹ ê·œë†, ì„±ì¥ë†, ì „ë¬¸ë† ê°™ì´ ë‹¤ì–‘í•œ ë†ì—…ì¸ë“¤ì„ ìœ„í•œ ì˜¨,ì˜¤í”„ë¼ì¸ êµìœ¡ê³¼ì •",
              link: "https://agriedu.net/"
            },
            {
              name: "ìŠ¤ë§ˆíŠ¸íŒœ ì²­ë…„ì°½ì—… ë³´ìœ¡ì„¼í„°",
              details: "ìŠ¤ë§ˆíŠ¸íŒœ ì˜ë†ê¸°ìˆ ì„ ë°°ìš°ê³ ì í¬ë§í•˜ëŠ” ì²­ë…„ ëª¨ì§‘<br>ë§Œ 18ì„¸ ì´ìƒ~ ë§Œ 39ì„¸ ì´í•˜ì˜ ëŒ€í•œë¯¼êµ­ êµ­ì  ì†Œì§€ì<br><br>ì…ë¬¸(2ê°œì›”), êµìœ¡í˜• ì‹¤ìŠµ(6ê°œì›”), ê²½ì˜í˜• ì‹¤ìŠµ(12ê°œì›”)=>20ê°œì›” ê³¼ì •<br><br>(ì „ë¶ ê¹€ì œ) ë”¸ê¸°, í† ë§ˆí† , ì˜¤ì´, ì—½ì±„ë¥˜<br><br>(ì „ë‚¨ ê³ í¥) : ë”¸ê¸°, í† ë§ˆí† , ë©œë¡ , ì•„ì—´ëŒ€ì‘(ë ˆëª¬ ë“±)<br><br>(ê²½ë¶ ìƒì£¼) ë”¸ê¸°, í† ë§ˆí† , ì˜¤ì´, ë©œë¡ <br><br>(ê²½ë‚¨ ë°€ì–‘) ë”¸ê¸°, í† ë§ˆí† , íŒŒí”„ë¦¬ì¹´, ê°€ì§€<br><br>*ì§€ì •ëœ êµìœ¡í’ˆëª© ì™¸ ìŠ¤ë§ˆíŠ¸íŒœ ì‹œì„¤ì›ì˜ˆ ë¶„ì•¼ì˜ ê¸°ì´ˆ êµìœ¡ì€ ê°€ëŠ¥í•˜ë‚˜, ì…ë¬¸êµìœ¡(ê¸°ì´ˆ)ì— í•œì •í•˜ì—¬ ì‹¤ì‹œ",
              link: "https://www.smartfarmkorea.net/edu/pnbsns/all.do?menuId=M11020401"
            },
            {
              name: "ì²­ë…„ê·€ë† ì˜¤í”„ë¼ì¸ ì¥ê¸°êµìœ¡",
              details: "ê·€ë† ì‹¤í–‰ ì „ ë†ì¥ã€®ìˆ™ë°• ë“± êµìœ¡ì‹œì„¤ì„ ê°–ì¶˜ ì‹¤ìŠµì¥ì—ì„œ 4~6ê°œì›”ê°„ ì§€ë‚´ë©´ì„œ ì‘ëª©ì˜ ìƒì‚°ë¶€í„° íŒë§¤ê¹Œì§€ ì „ê³¼ì • ì‹¤ìŠµ<br>*ê°•ì‚¬ë¹„, ìˆ™ë°•ë¹„ ë“±ì„ ì§€ì›í•˜ë©° ì§ì ‘êµìœ¡ë¹„ì˜ 10%ëŠ” êµìœ¡ìƒ ë¶€ë‹´(60~90ë§Œì› ìˆ˜ì¤€/êµìœ¡ê¸°ê´€ë³„ ìƒì´ )<br>",
              link: "https://www.greendaero.go.kr/svc/rfph/edc/offline/front/intensificationIntro2.do"
            }
          ]
        }
      ],
  startup: [
    {
      id: "startup1",
      title: "ì²­ë…„ ë†ì—… ì°½ì—… ì§€ì›ê¸ˆ",
      description: "ë†ì—… ì°½ì—… ì´ˆê¸° ë¹„ìš©ì„ ì§€ì›í•˜ì—¬ ì‚¬ì—… ì•ˆì •ì„±ì„ ë†’ì…ë‹ˆë‹¤.",
      source: "ì¶œì²˜: ë†ë¦¼ì¶•ì‚°ì‹í’ˆë¶€",
      link: ["https://www.rda.go.kr"]
    }
  ]
};


// ------------------ ì¹´í…Œê³ ë¦¬ë³„ ì •ì±… í‘œì‹œ ------------------
function showCategory(category) {
  const container = document.getElementById('policy-container');
  container.innerHTML = '';

  const regionPolicies = policies[category] || [];

  regionPolicies.forEach(policy => {
    const card = document.createElement('div');
    card.className = 'policy-card';
    const isFav = isFavorite(policy.id);
    const star = isFav ? 'â­' : 'â˜†';

    card.innerHTML = `
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2>${policy.title}</h2>
        <span id="fav-${policy.id}" style="cursor:pointer; font-size:1.5em;">${star}</span>
      </div>
      <p class="policy-description">${policy.description}</p>
      <p class="policy-source">${policy.source}</p>
    `;

    card.querySelector(`#fav-${policy.id}`).onclick = (e) => {
      e.stopPropagation();
      toggleFavorite(policy.id, policy.title, false, e.target);
    };

    card.onclick = () => {
      if (policy.subcategories) showSubcategories(policy.subcategories);
      else openModal(policy);
    };

    container.appendChild(card);
  });
}

// ------------------ í•˜ìœ„ ì •ì±… ------------------
function showSubcategories(subcategories) {
  const subContainer = document.getElementById('sub-category-container');
  subContainer.innerHTML = '';
  subContainer.style.display = 'block';
  subcategories.forEach(sub => {
    const btn = document.createElement('button');
    const isFav = isFavorite(sub.id);
    btn.className = 'category-btn';
    btn.textContent = (isFav ? 'â­ ' : '') + sub.name;
    btn.onclick = () => openModal(sub);
    subContainer.appendChild(btn);
  });
}

// ------------------ ëª¨ë‹¬ ------------------
function openModal(policy) {
  recordRecentlyViewed(policy); // âœ… ìµœê·¼ ë³¸ ì •ì±… ê¸°ë¡ ì¶”ê°€
  const modal = document.getElementById('modal');
  const body = document.getElementById('modal-body');
  const isFav = isFavorite(policy.id);
  const star = isFav ? 'â­' : 'â˜†';

  let linksHtml = '';
  if (Array.isArray(policy.links)) {
    linksHtml = policy.links.map(l => `<a href="${l.url}" target="_blank">${l.name}</a>`).join('<br>');
  } else if (Array.isArray(policy.link)) {
    linksHtml = policy.link.map(url => `<a href="${url}" target="_blank">${url}</a>`).join('<br>');
  } else if (policy.link) {
    linksHtml = `<a href="${policy.link}" target="_blank">${policy.link}</a>`;
  }

  body.innerHTML = `
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h2>${policy.name || policy.title}</h2>
      <span id="fav-modal" style="cursor:pointer; font-size:1.5em;">${star}</span>
    </div>
    <p>${policy.details || policy.description}</p>
    <div>${linksHtml}</div>
  `;

  document.getElementById('fav-modal').onclick = (e) => {
    e.stopPropagation();
    toggleFavorite(policy.id, policy.name || policy.title, !!policy.name, e.target);
  };

  modal.style.display = 'block';
}

function closeModal() { document.getElementById('modal').style.display = 'none'; }

// ------------------ ì¦ê²¨ì°¾ê¸° ------------------
function toggleFavorite(id, title, isSub, element) {
  const region = document.getElementById('region-select').value || 'jeonbuk';
  let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
  const index = favorites.findIndex(f => f.id === id && f.region === region);

  if (index > -1) {
    favorites.splice(index, 1);
    if (element) element.textContent = 'â˜†';
  } else {
    favorites.push({ id, title, isSub, region });
    if (element) element.textContent = 'â­';
  }

  localStorage.setItem('favorites', JSON.stringify(favorites));
}

function isFavorite(id) {
  const region = document.getElementById('region-select').value || 'jeonbuk';
  const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
  return favorites.some(f => f.id === id && f.region === region);
}

// ì¦ê²¨ì°¾ê¸° ë³´ê¸° (ì„ íƒí•œ ì§€ì—­ë§Œ)
function showFavorites() {
  const container = document.getElementById('policy-container');
  const subContainer = document.getElementById('sub-category-container');

  subContainer.style.display = 'none';
  subContainer.innerHTML = '';

  const selectedRegion = document.getElementById('region-select').value || 'jeonbuk';
  container.innerHTML = `<h2>â­ ì¦ê²¨ì°¾ê¸°í•œ ì •ì±…</h2>`;
  
  const favorites = (JSON.parse(localStorage.getItem('favorites')) || [])
                     .filter(f => f.isSub && f.region === selectedRegion);

  if (favorites.length === 0) {
    container.innerHTML += '<p>ì¦ê²¨ì°¾ê¸°í•œ ì •ì±…ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
    return;
  }

  let allSubs = [];
  Object.values(policies).forEach(cat => {
    cat.forEach(p => {
      if (p.subcategories) allSubs.push(...p.subcategories);
    });
  });

  favorites.forEach(fav => {
    const found = allSubs.find(s => s.id === fav.id);
    if (found) {
      const card = document.createElement('div');
      card.className = 'policy-card';

      let linksHtml = '';
      if (Array.isArray(found.links)) {
        linksHtml = found.links.map(l => `<a href="${l.url}" target="_blank">${l.name}</a>`).join('<br>');
      } else if (found.link) {
        linksHtml = `<a href="${found.link}" target="_blank">${found.link}</a>`;
      }

      card.innerHTML = `
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <h2>${found.name}</h2>
          <span id="fav-${found.id}" style="cursor:pointer; font-size:1.5em;">â­</span>
        </div>
        <p class="policy-description">${found.details}</p>
        <div>${linksHtml}</div>
      `;

      card.querySelector(`#fav-${found.id}`).onclick = (e) => {
        e.stopPropagation();
        toggleFavorite(found.id, found.name, true, e.target);
        card.remove();
      };

      card.onclick = () => openModal(found);
      container.appendChild(card);
    }
  });
}

// ------------------ ğŸ“„ ìµœê·¼ ë³¸ ì •ì±… ê¸°ëŠ¥ ------------------

// ì •ì±… ì—´ëŒ ì‹œ ê¸°ë¡
function recordRecentlyViewed(policy) {
  let viewed = JSON.parse(localStorage.getItem('recentlyViewed')) || [];
  const region = document.getElementById('region-select').value || 'ì „ì²´ì§€ì—­';

  viewed = viewed.filter(p => !(p.id === policy.id && p.region === region));

  viewed.unshift({
    id: policy.id,
    title: policy.name || policy.title,
    region,
    viewedAt: new Date().toISOString()
  });

  if (viewed.length > 10) viewed = viewed.slice(0, 10);
  localStorage.setItem('recentlyViewed', JSON.stringify(viewed));
}

// ìµœê·¼ ë³¸ ì •ì±… ë³´ê¸°
function showRecent() {
  const container = document.getElementById('policy-container');
  const subContainer = document.getElementById('sub-category-container');
  subContainer.style.display = 'none';
  subContainer.innerHTML = '';

  container.innerHTML = '<h2>ğŸ“„ ìµœê·¼ ë³¸ ì •ì±…</h2>';
  const recent = JSON.parse(localStorage.getItem('recentlyViewed')) || [];

  if (recent.length === 0) {
    container.innerHTML += '<p>ìµœê·¼ ë³¸ ì •ì±…ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
    return;
  }

  recent.forEach(item => {
    const card = document.createElement('div');
    card.className = 'policy-card';
    card.innerHTML = `
      <div style="display:flex; justify-content:space-between;">
        <h3>${item.title}</h3>
        <span style="font-size:0.8em; color:#888;">${new Date(item.viewedAt).toLocaleString()}</span>
      </div>
      <p class="policy-source">${item.region}</p>
    `;
    card.onclick = () => reopenPolicy(item.id);
    container.appendChild(card);
  });
}

// ìµœê·¼ ë³¸ ì •ì±… ë‹¤ì‹œ ì—´ê¸°
function reopenPolicy(id) {
  let found = null;
  Object.values(policies).forEach(cat => {
    cat.forEach(p => {
      if (p.id === id) found = p;
      if (p.subcategories) {
        const sub = p.subcategories.find(s => s.id === id);
        if (sub) found = sub;
      }
    });
  });
  if (found) openModal(found);
}
</script>
</body>
</html>
